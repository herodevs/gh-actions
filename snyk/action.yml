
name: Run Snyk Scan
description: Runs Snyk Scan

inputs:
  snykToken:
    description: The snyk token used to access snyk cloud and/or run scan
    required: true
  snykOrgId:
    description: The ID of the organization to access snyk cloud and/or run scan
    required: true
  snykThreshold:
    description: The snyk threshold to fail on
    default: medium
    required: false
  policyPath:
    description: The path to the .snyk file that establishes policy exceptions for a given repo
    required: false

runs:
  using: composite
  steps:

    - name: Run Snyk to check for vulnerabilities
      if: ${{ inputs.policyPath == '' }}
      uses: snyk/actions/node@master
      with:
        args: --severity-threshold=${{ inputs.snykThreshold }} --all-projects --org=${{ inputs.snykOrgId }}
      env:
        SNYK_TOKEN: ${{ inputs.snykToken }}

    - name: Run Snyk to check for vulnerabilities
      if: ${{ inputs.policyPath != '' }}
      uses: snyk/actions/node@master
      with:
        args: --severity-threshold=${{ inputs.snykThreshold }} --all-projects --policy-path=${{ inputs.policyPath }} --org=${{ inputs.snykOrgId }}
      env:
        SNYK_TOKEN: ${{ inputs.snykToken }}
